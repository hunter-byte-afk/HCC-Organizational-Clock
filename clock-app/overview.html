<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Overview</title>
        <link rel = "stylesheet" href = "style.css">
    </head>
    <body class = "overview">
        <!--navbar-->
        <div class = "navbar">
            <a class = "active" href = "overview.html">Overview</a>
            <a href = "clock.html">Clock In/Out</a>
            <a href = "calendar.html">Calendar</a>
            <a class = "navLogOut" href = "index.html">Log Out</a>
        </div>

        <div class = overviewLayout>
            <div class = "tasks">
                <div class = "header">  
                    <h1> Tasks </h1>
                    <input type = "text" id = "newTask" placeholder= "New Task">
                    <span onclick = "newElement()" class = "addTask">Add Task</span>
                </div>

                <ul id = "taskList">

                </ul>
            </div>
        
            <div id="overlay" onclick="off()">
            
            <div class = "overlayClock">
                <!--Clock COPIED FROM CLOCK.HTML--> 
                <div class="container">
                    <div class="clock-display">
                        <div class="current-time" id="currentTime">00:00:00</div>
                        <div class="status" id="status">Not Clocked In</div>
                    </div>
                    <!-- this is currently not working as intended and needs to be altered for final project-->
                    <div class="button-group">
                        <button id="clockInBtn" class="btn btn-in" onclick="clockIn()">Clock In</button>
                        <button id="clockOutBtn" class="btn btn-out" onclick="clockOut()" disabled>Clock Out</button>
                    </div>

                    <div class="stats">
                        <div class="stat-item">
                            <span class="stat-label">Today's Hours:</span>
                            <span class="stat-value" id="todayHours">0h 0m</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Clocked In Since:</span>
                            <span class="stat-value" id="clockedInTime">--:-- --</span>
                        </div>
                    </div>

                    <div class="time-entries">
                        <h2>Time Entries</h2>
                        <div id="entriesList" class="entries-list">
                            <p class="empty-message">No entries yet</p>
                        </div>
                    </div>
                </div>
                <script src="./clock.js"></script>
            </div>
        </div>

            <div class = "calendarOverview">
                <div class="calendar-container">
                <div class="calendar-header">
                    <button id="prev-month" class="nav-btn">Prev</button>
                    <h2 id="current-month"></h2>
                    <button id="next-month" class="nav-btn">Next</button>
                </div>
                    <table class="calendar" aria-label="Monthly calendar">
                        <thead>
                            <tr>
                                <th>Sun</th>
                                <th>Mon</th>
                                <th>Tue</th>
                                <th>Wed</th>
                                <th>Thu</th>
                                <th>Fri</th>
                                <th>Sat</th>
                            </tr>
                        </thead>
                        <tbody id="calendar-body">
                        </tbody>
                    </table>
                </div>
                <script>
                (function monthlyRenderer(){
                    const monthTitle = document.getElementById('current-month');
                    const body = document.getElementById('calendar-body');
                    const prevBtn = document.getElementById('prev-month');
                    const nextBtn = document.getElementById('next-month');

                    // keep track of visible month
                    let viewDate = new Date();
                    viewDate.setDate(1);

                    function render(){
                        const year = viewDate.getFullYear();
                        const month = viewDate.getMonth();
                        const today = new Date();

                        monthTitle.textContent = viewDate.toLocaleString(undefined, { month: 'long', year: 'numeric' });

                        // compute month layout
                        const firstDayIndex = new Date(year, month, 1).getDay();
                        const daysInMonth = new Date(year, month + 1, 0).getDate();
                        const daysInPrev = new Date(year, month, 0).getDate();

                        body.innerHTML = '';

                        // 6 weeks to cover all month layouts
                        let dayCounter = 1 - firstDayIndex;
                        for(let week = 0; week < 6; week++){
                            const tr = document.createElement('tr');
                            for(let d = 0; d < 7; d++){
                                const td = document.createElement('td');

                                const cellDate = new Date(year, month, dayCounter);
                                const cellDay = cellDate.getDate();

                                const dateDiv = document.createElement('div');
                                dateDiv.className = 'date-number';
                                dateDiv.textContent = cellDay;
                                td.appendChild(dateDiv);

                                // mark other-month days
                                if(dayCounter < 1){
                                    td.classList.add('other-month');
                                } else if(dayCounter > daysInMonth){
                                    td.classList.add('other-month');
                                } else {
                                    // current month day
                                    // mark today
                                    if(cellDate.toDateString() === today.toDateString()){
                                        td.classList.add('today');
                                    }
                                }

                                // space for events/hours
                                const eventsDiv = document.createElement('div');
                                eventsDiv.className = 'hours';
                                eventsDiv.textContent = '';
                                td.appendChild(eventsDiv);

                                tr.appendChild(td);
                                dayCounter++;
                            }
                            body.appendChild(tr);
                        }
                    }
                    
                    //listener for pop-up
                    const overlay = document.getElementById("clockOverlay");
                    body.addEventListener('click', (e) => {
                        if(e.target.tagName == 'TD'){
                            document.getElementById("overlay").style.display = "flex";
                        }
                    });

                    prevBtn.addEventListener('click', () => {
                        viewDate.setMonth(viewDate.getMonth() - 1);
                        render();
                    });

                    nextBtn.addEventListener('click', () => {
                        viewDate.setMonth(viewDate.getMonth() + 1);
                        render();
                    });

                    // initial render
                    render();
                })();

                function on() {
                    document.getElementById("overlay").style.display = "flex";
                }

                function off() {
                    document.getElementById("overlay").style.display = "none";
                }
                </script>
            </div>
        </div>
        <script src = "overview.js"></script>
    </body>
</html>